{
  "version": 3,
  "names": [
    "delay",
    "time",
    "Promise",
    "resolve",
    "reject",
    "window",
    "setTimeout",
    "DEFAULT_RETRY_TIME",
    "APILoader",
    "props",
    "error",
    "isMountedOk",
    "setState",
    "type",
    "BMap",
    "BMapGL",
    "loaded",
    "state",
    "Map",
    "akay",
    "TypeError",
    "callbackName",
    "waitQueue",
    "push",
    "finish",
    "handleError",
    "loadMap",
    "children",
    "fallback",
    "color",
    "message",
    "cfg",
    "protocol",
    "location",
    "indexOf",
    "args",
    "version",
    "hostAndPath",
    "join",
    "src",
    "getScriptSrc",
    "queue",
    "forEach",
    "task",
    "i",
    "requireScript",
    "err",
    "Error",
    "res",
    "rej",
    "React",
    "Component"
  ],
  "sources": [
    "../src/index.tsx"
  ],
  "sourcesContent": [
    "/**\n * 初始化和加载baidu地图\n */\nimport React from 'react';\nimport { requireScript } from '@uiw/react-baidu-map-utils';\n\ndeclare global {\n  interface Window {\n    [index: string]: () => any; // or just any\n  }\n}\n\nexport interface APILoaderConfig {\n  /**\n   * akay 密钥\n   * 您需先申请密钥（ak）才可使用该服务，接口无使用次数限制，请开发者放心使用。\n   * 文档说明地址：http://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/getkey\n   * 申请秘钥地址：http://lbs.baidu.com/apiconsole/key?application=key\n   */\n  akay: string;\n  /**\n   * SDK 包版本\n   * @default 3.0\n   */\n  version?: string;\n  /**\n   * 协议，默认是根据当前网站协议的\n   */\n  protocol?: 'http' | 'https';\n  /**\n   * 请求 SDK 的前半部分\n   * http://api.map.baidu.com/api?v=2.0&ak=E480562045\n   * @default api.map.baidu.com/api\n   */\n  hostAndPath?: string;\n  /**\n   * JSONP 回调函数\n   */\n  callbackName?: string;\n  /**\n   * 百度地图JavaScript API GL v1.0是一套由JavaScript语言编写的应用程序接口，可帮助您在网站中构建功能丰富、交互性强的地图应用，支持PC端和移动端基于浏览器的地图应用开发，且支持HTML5特性的地图开发。\n   * JavaScript API GL使用了WebGL对地图、覆盖物等进行渲染，支持3D视角展示地图。 GL版本接口基本向下兼容，迁移成本低。目前v1.0版本支持了基本的3D地图展示、基本地图控件和覆盖物。\n   */\n  type?: 'webgl';\n}\n\nexport function delay(time: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    window && window.setTimeout(resolve, time);\n  });\n}\n\nexport interface APILoaderProps extends APILoaderConfig {\n  /**\n   * 用于展示加载中或错误状态\n   */\n  fallback?: (error?: Error) => React.ReactNode;\n}\n\ninterface State {\n  loaded: boolean;\n  error?: Error;\n}\n\nconst DEFAULT_RETRY_TIME = 3;\n\n/**\n * APILoader 用于加载百度地图依赖\n */\nexport default class APILoader extends React.Component<React.PropsWithChildren<APILoaderProps>, State> {\n  public static defaultProps = {\n    akay: '',\n    hostAndPath: 'api.map.baidu.com/api',\n    version: '2.0',\n    callbackName: 'load_bmap_sdk',\n    type: '',\n  };\n\n  private isMountedOk: boolean = false;\n\n  /**\n   * 全局可能存在多个Loader同时渲染, 但是只能由一个负责加载\n   */\n  private static waitQueue: Array<[Function, Function]> = [];\n  /**\n   * 等待BMap就绪\n   */\n  public static async ready() {\n    if (window && window.BMap.Map) {\n      return;\n    }\n    if (window && window.BMapGL.Map) {\n      return;\n    }\n    return new Promise((res, rej) => {\n      APILoader.waitQueue.push([res, rej]);\n    });\n  }\n  public constructor(props: APILoaderProps) {\n    super(props);\n    this.state = {\n      loaded:\n        props.type === 'webgl'\n          ? window && !!window.BMapGL && !!window.BMapGL.Map\n          : window && !!window.BMap && !!window.BMap.Map,\n    };\n    if (this.props.akay == null) {\n      throw new TypeError('BaiDuMap: akay is required');\n    }\n  }\n\n  public componentDidMount() {\n    this.isMountedOk = true;\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    if (\n      (this.props.type === 'webgl' && window && window.BMapGL && !window.BMapGL.Map) ||\n      (this.props.type === 'webgl' && window && !window.BMapGL) ||\n      (window && window.BMap && !window.BMap.Map) ||\n      (window && !window.BMap)\n    ) {\n      if (window && window[callbackName]) {\n        APILoader.waitQueue.push([this.finish, this.handleError]);\n        return;\n      }\n\n      this.loadMap();\n    }\n  }\n\n  componentWillUnmount() {\n    this.isMountedOk = false;\n  }\n\n  public render() {\n    if (window && window.BMapGL && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    return this.state.loaded ? (\n      this.props.children\n    ) : this.props.fallback ? (\n      this.props.fallback(this.state.error)\n    ) : this.state.error ? (\n      <div style={{ color: 'red' }}>{this.state.error.message}</div>\n    ) : null;\n  }\n\n  private getScriptSrc() {\n    const cfg = this.props;\n    let protocol = (cfg.protocol || window.location.protocol) as APILoaderConfig['protocol'];\n    if (protocol!.indexOf(':') === -1) {\n      protocol += ':';\n    }\n    const args = [`v=${cfg.version}`, `ak=${cfg.akay}`, `callback=${cfg.callbackName}`];\n    if (cfg.type) {\n      args.push(`type=${cfg.type}`);\n    }\n    return `${protocol}//${cfg.hostAndPath}?${args.join('&')}`;\n  }\n  /**\n   * load BaiduMap in script tag\n   */\n  private async loadMap() {\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    const src = this.getScriptSrc();\n    window[callbackName] = () => {\n      // flush queue\n      const queue = APILoader.waitQueue;\n      APILoader.waitQueue = [];\n      queue.forEach((task) => task[0]());\n      this.finish();\n    };\n\n    for (let i = 0; i < DEFAULT_RETRY_TIME; i++) {\n      try {\n        await requireScript(src);\n        break;\n      } catch (error: any) {\n        if (i === DEFAULT_RETRY_TIME - 1) {\n          const err = new Error(`Failed to load Baidu Map: ${error.message}`);\n          // flush queue\n          const queue = APILoader.waitQueue;\n          APILoader.waitQueue = [];\n          queue.forEach((task) => task[1](err));\n          this.handleError(err);\n          return;\n        }\n        await delay(i * 1000);\n      }\n    }\n  }\n\n  private handleError = (error: Error) => {\n    if (this.isMountedOk) {\n      this.setState({ error });\n    }\n  };\n\n  private finish = () => {\n    if (window && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    if (this.isMountedOk) {\n      this.setState({\n        loaded: true,\n      });\n    }\n  };\n}\n"
  ],
  "mappings": "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"
}