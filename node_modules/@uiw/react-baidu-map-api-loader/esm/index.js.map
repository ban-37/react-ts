{
  "version": 3,
  "names": [
    "React",
    "requireScript",
    "delay",
    "time",
    "Promise",
    "resolve",
    "reject",
    "window",
    "setTimeout",
    "DEFAULT_RETRY_TIME",
    "APILoader",
    "Component",
    "ready",
    "BMap",
    "Map",
    "BMapGL",
    "res",
    "rej",
    "waitQueue",
    "push",
    "constructor",
    "props",
    "isMountedOk",
    "handleError",
    "error",
    "setState",
    "finish",
    "type",
    "loaded",
    "state",
    "akay",
    "TypeError",
    "componentDidMount",
    "callbackName",
    "loadMap",
    "componentWillUnmount",
    "render",
    "children",
    "fallback",
    "color",
    "message",
    "getScriptSrc",
    "cfg",
    "protocol",
    "location",
    "indexOf",
    "args",
    "version",
    "hostAndPath",
    "join",
    "src",
    "queue",
    "forEach",
    "task",
    "i",
    "err",
    "Error",
    "defaultProps"
  ],
  "sources": [
    "../src/index.tsx"
  ],
  "sourcesContent": [
    "/**\n * 初始化和加载baidu地图\n */\nimport React from 'react';\nimport { requireScript } from '@uiw/react-baidu-map-utils';\n\ndeclare global {\n  interface Window {\n    [index: string]: () => any; // or just any\n  }\n}\n\nexport interface APILoaderConfig {\n  /**\n   * akay 密钥\n   * 您需先申请密钥（ak）才可使用该服务，接口无使用次数限制，请开发者放心使用。\n   * 文档说明地址：http://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/getkey\n   * 申请秘钥地址：http://lbs.baidu.com/apiconsole/key?application=key\n   */\n  akay: string;\n  /**\n   * SDK 包版本\n   * @default 3.0\n   */\n  version?: string;\n  /**\n   * 协议，默认是根据当前网站协议的\n   */\n  protocol?: 'http' | 'https';\n  /**\n   * 请求 SDK 的前半部分\n   * http://api.map.baidu.com/api?v=2.0&ak=E480562045\n   * @default api.map.baidu.com/api\n   */\n  hostAndPath?: string;\n  /**\n   * JSONP 回调函数\n   */\n  callbackName?: string;\n  /**\n   * 百度地图JavaScript API GL v1.0是一套由JavaScript语言编写的应用程序接口，可帮助您在网站中构建功能丰富、交互性强的地图应用，支持PC端和移动端基于浏览器的地图应用开发，且支持HTML5特性的地图开发。\n   * JavaScript API GL使用了WebGL对地图、覆盖物等进行渲染，支持3D视角展示地图。 GL版本接口基本向下兼容，迁移成本低。目前v1.0版本支持了基本的3D地图展示、基本地图控件和覆盖物。\n   */\n  type?: 'webgl';\n}\n\nexport function delay(time: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    window && window.setTimeout(resolve, time);\n  });\n}\n\nexport interface APILoaderProps extends APILoaderConfig {\n  /**\n   * 用于展示加载中或错误状态\n   */\n  fallback?: (error?: Error) => React.ReactNode;\n}\n\ninterface State {\n  loaded: boolean;\n  error?: Error;\n}\n\nconst DEFAULT_RETRY_TIME = 3;\n\n/**\n * APILoader 用于加载百度地图依赖\n */\nexport default class APILoader extends React.Component<React.PropsWithChildren<APILoaderProps>, State> {\n  public static defaultProps = {\n    akay: '',\n    hostAndPath: 'api.map.baidu.com/api',\n    version: '2.0',\n    callbackName: 'load_bmap_sdk',\n    type: '',\n  };\n\n  private isMountedOk: boolean = false;\n\n  /**\n   * 全局可能存在多个Loader同时渲染, 但是只能由一个负责加载\n   */\n  private static waitQueue: Array<[Function, Function]> = [];\n  /**\n   * 等待BMap就绪\n   */\n  public static async ready() {\n    if (window && window.BMap.Map) {\n      return;\n    }\n    if (window && window.BMapGL.Map) {\n      return;\n    }\n    return new Promise((res, rej) => {\n      APILoader.waitQueue.push([res, rej]);\n    });\n  }\n  public constructor(props: APILoaderProps) {\n    super(props);\n    this.state = {\n      loaded:\n        props.type === 'webgl'\n          ? window && !!window.BMapGL && !!window.BMapGL.Map\n          : window && !!window.BMap && !!window.BMap.Map,\n    };\n    if (this.props.akay == null) {\n      throw new TypeError('BaiDuMap: akay is required');\n    }\n  }\n\n  public componentDidMount() {\n    this.isMountedOk = true;\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    if (\n      (this.props.type === 'webgl' && window && window.BMapGL && !window.BMapGL.Map) ||\n      (this.props.type === 'webgl' && window && !window.BMapGL) ||\n      (window && window.BMap && !window.BMap.Map) ||\n      (window && !window.BMap)\n    ) {\n      if (window && window[callbackName]) {\n        APILoader.waitQueue.push([this.finish, this.handleError]);\n        return;\n      }\n\n      this.loadMap();\n    }\n  }\n\n  componentWillUnmount() {\n    this.isMountedOk = false;\n  }\n\n  public render() {\n    if (window && window.BMapGL && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    return this.state.loaded ? (\n      this.props.children\n    ) : this.props.fallback ? (\n      this.props.fallback(this.state.error)\n    ) : this.state.error ? (\n      <div style={{ color: 'red' }}>{this.state.error.message}</div>\n    ) : null;\n  }\n\n  private getScriptSrc() {\n    const cfg = this.props;\n    let protocol = (cfg.protocol || window.location.protocol) as APILoaderConfig['protocol'];\n    if (protocol!.indexOf(':') === -1) {\n      protocol += ':';\n    }\n    const args = [`v=${cfg.version}`, `ak=${cfg.akay}`, `callback=${cfg.callbackName}`];\n    if (cfg.type) {\n      args.push(`type=${cfg.type}`);\n    }\n    return `${protocol}//${cfg.hostAndPath}?${args.join('&')}`;\n  }\n  /**\n   * load BaiduMap in script tag\n   */\n  private async loadMap() {\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    const src = this.getScriptSrc();\n    window[callbackName] = () => {\n      // flush queue\n      const queue = APILoader.waitQueue;\n      APILoader.waitQueue = [];\n      queue.forEach((task) => task[0]());\n      this.finish();\n    };\n\n    for (let i = 0; i < DEFAULT_RETRY_TIME; i++) {\n      try {\n        await requireScript(src);\n        break;\n      } catch (error: any) {\n        if (i === DEFAULT_RETRY_TIME - 1) {\n          const err = new Error(`Failed to load Baidu Map: ${error.message}`);\n          // flush queue\n          const queue = APILoader.waitQueue;\n          APILoader.waitQueue = [];\n          queue.forEach((task) => task[1](err));\n          this.handleError(err);\n          return;\n        }\n        await delay(i * 1000);\n      }\n    }\n  }\n\n  private handleError = (error: Error) => {\n    if (this.isMountedOk) {\n      this.setState({ error });\n    }\n  };\n\n  private finish = () => {\n    if (window && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    if (this.isMountedOk) {\n      this.setState({\n        loaded: true,\n      });\n    }\n  };\n}\n"
  ],
  "mappings": "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"
}